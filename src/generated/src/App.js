// Generated by Melange

import * as Caml_array from "melange.js/caml_array.js";
import * as Curry from "melange.js/curry.js";
import * as React from "react";
import * as JsxRuntime from "react/jsx-runtime";

function make(q) {
  return function (id) {
    return JsxRuntime.jsxs("div", {
                children: [
                  JsxRuntime.jsx("span", {
                        children: q,
                        className: ""
                      }),
                  JsxRuntime.jsx("input", {
                        name: id,
                        placeholder: "your answer..."
                      })
                ],
                className: ""
              });
  };
}

function App$Question(Props) {
  return make(Props.q)(Props.id);
}

const Question = {
  make: App$Question,
  $$default: App$Question
};

function App$NotRunning(Props) {
  return JsxRuntime.jsx("div", {
              children: "No active questions",
              className: "text-white"
            });
}

const NotRunning = {
  make: App$NotRunning
};

function App$Done(Props) {
  return JsxRuntime.jsx("div", {
              children: "You are so good at answering",
              className: "text-white"
            });
}

const Done = {
  make: App$Done
};

function make$1(question) {
  return function (setIdx) {
    return JsxRuntime.jsxs("div", {
                children: [
                  JsxRuntime.jsxs("div", {
                        children: [
                          JsxRuntime.jsx("span", {
                                children: "Question: ",
                                className: "text-white"
                              }),
                          JsxRuntime.jsx("span", {
                                children: question,
                                className: "text-white"
                              })
                        ],
                        className: "question"
                      }),
                  JsxRuntime.jsx("div", {
                        children: JsxRuntime.jsx("input", {
                              name: "answer",
                              placeholder: "rizz me daddy",
                              type: "text"
                            }),
                        className: "answer"
                      }),
                  JsxRuntime.jsx("button", {
                        children: "Next",
                        className: "text-white",
                        onClick: (function (evt) {
                            Curry._1(setIdx, (function (v) {
                                    console.log([
                                          "v",
                                          v
                                        ]);
                                    return v + 1 | 0;
                                  }));
                          })
                      })
                ],
                className: ""
              });
  };
}

function App$Questionaire(Props) {
  return make$1(Props.question)(Props.setIdx);
}

const Questionaire = {
  make: App$Questionaire
};

const listenWebSocket = (function(url, callback) {
        console.log("listening to websocket", url)
        const ws = new WebSocket(url)
        ws.onmessage = function(evt) {
            console.log("got message", evt.data)
            try {
                const data = JSON.parse(evt.data)
                callback(data, () => { ws.close() })
            } catch (e) {
            }
        }
    }
);

function App$App(Props) {
  let state = Props.state;
  const match = React.useState(function () {
        return state.currentIdx;
      });
  const idx = match[0];
  const match$1 = React.useState(function () {
        return state.running;
      });
  const setRunning = match$1[1];
  const match$2 = React.useState(function () {
        return state.questions;
      });
  const setQuestions = match$2[1];
  React.useEffect(function () {
        return listenWebSocket("ws://localhost:3000/ws", (function (state) {
                      console.log(state);
                      Curry._1(setRunning, (function (param) {
                              return state.running;
                            }));
                      Curry._1(setQuestions, (function (param) {
                              return state.questions;
                            }));
                    }));
      });
  if (match$1[0]) {
    if (idx < state.questions.length) {
      return JsxRuntime.jsx(App$Questionaire, {
                  question: Caml_array.get(state.questions, idx),
                  setIdx: match[1]
                });
    } else {
      return JsxRuntime.jsx(App$Done, {});
    }
  } else {
    return JsxRuntime.jsx(App$NotRunning, {});
  }
}

const App = {
  make: App$App,
  $$default: App$App
};

const $$default = App$App;

export {
  Question ,
  NotRunning ,
  Done ,
  Questionaire ,
  listenWebSocket ,
  App ,
  $$default as default,
}
/* react Not a pure module */
